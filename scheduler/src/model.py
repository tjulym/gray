import joblib
import sys

BEs = [
    [5915,75,56,55,3,1,9,0.0378,1.5463,39.9053,0.302,10985.36,26.5,0.3,0.0,0.01],
    [6449,65,47,64,4,1,9,0.0232,1.9005,8.1887,0.0305,910.32,25.91,0.57,225.28,0.01],
    [9368,40,47,34,3,0,5,0.0131,1.9711,34.7152,0.0424,544.98,25.61,0.52,0.0,0.01]
]

LCs = [
     [25236.0, 56.0, 36.0, 45.0, 4.0, 0.0, 7.0, 0.0057, 1.6793, 0.2821, 0.0006, 2967.7, 23.91, 0.68, 0.0, 0.18], 
     [18132.0, 122.0, 41.0, 53.0, 2.0, 2.0, 9.0, 0.0063, 1.5224, 0.1, 0.0007, 2886.24, 23.61, 0.6, 0.0, 0.22], 
     [23533.0, 60.0, 37.0, 46.0, 4.0, 0.0, 8.0, 0.0062, 1.6827, 0.1858, 0.0005, 3235.39, 24.0, 0.67, 0.0, 0.05], 
     [24214.0, 57.0, 37.0, 45.0, 4.0, 0.0, 7.0, 0.0059, 1.6824, 0.2853, 0.0006, 3105.69, 24.28, 0.67, 0.0, 0.05], 
     [48907.0, 57.0, 36.0, 44.0, 4.0, 0.0, 7.0, 0.003, 1.6629, 0.3726, 0.0006, 3135.41, 24.65, 0.68, 0.0, 0.08], 
     [149.0, 68.0, 50.0, 87.0, 3.0, 1.0, 11.0, 0.456, 1.7408, 0.0017, 0.0001, 2954.15, 23.96, 0.44, 0.0, 0.0], 
     [560.0, 11.0, 15.0, 17.0, 1.0, 0.0, 3.0, 0.0401, 1.5071, 0.0144, 0.0012, 2943.4, 23.52, 0.51, 0.0, 0.0], 
     [341.0, 75.0, 36.0, 53.0, 4.0, 1.0, 8.0, 0.4764, 1.7255, 0.0014, 0.0005, 3103.67, 23.66, 0.55, 0.0, 0.0], 
     [3452.0, 16.0, 5.0, 10.0, 0.0, 0.0, 1.0, 0.0012, 1.3612, 0.1828, 0.0011, 3042.7, 23.63, 1.49, 0.0, 0.03], 
     [26562.0, 57.0, 37.0, 45.0, 4.0, 0.0, 7.0, 0.0056, 1.6895, 0.624, 0.0007, 3008.01, 23.82, 0.67, 0.0, 0.22], 
     [26319.0, 57.0, 38.0, 45.0, 4.0, 0.0, 7.0, 0.0057, 1.6929, 0.6269, 0.0007, 3065.91, 24.18, 0.67, 0.0, 0.26], 
     [25894.0, 57.0, 37.0, 45.0, 4.0, 0.0, 7.0, 0.0057, 1.6966, 0.275, 0.0006, 2937.26, 22.89, 0.65, 0.0, 0.16], 
     [26397.0, 58.0, 37.0, 46.0, 4.0, 0.0, 7.0, 0.0056, 1.6948, 0.1986, 0.0005, 3063.99, 24.23, 0.67, 0.0, 0.06], 
     [26443.0, 58.0, 38.0, 47.0, 4.0, 0.0, 7.0, 0.0057, 1.6828, 0.2868, 0.0006, 3025.83, 24.0, 0.66, 0.0, 0.16], 
     [25797.0, 58.0, 38.0, 46.0, 4.0, 0.0, 7.0, 0.0059, 1.6914, 0.2784, 0.0006, 3079.88, 24.34, 0.67, 0.0, 0.15], 
     [25812.0, 58.0, 37.0, 44.0, 4.0, 1.0, 8.0, 0.0057, 1.7005, 0.628, 0.0006, 3043.68, 23.34, 0.67, 0.0, 0.22], 
     [25175.0, 59.0, 38.0, 44.0, 4.0, 1.0, 8.0, 0.0057, 1.6827, 0.8592, 0.0015, 3069.73, 24.24, 0.69, 0.0, 0.56], 
     [7358.0, 82.0, 55.0, 77.0, 6.0, 1.0, 10.0, 0.0344, 1.7895, 0.0211, 0.0001, 3083.93, 24.2, 0.51, 0.0, 0.01], 
     [598.0, 14.0, 15.0, 17.0, 1.0, 0.0, 3.0, 0.0394, 1.4635, 0.0171, 0.0011, 2915.94, 23.58, 0.48, 0.0, 0.0], 
     [8844.0, 35.0, 14.0, 27.0, 1.0, 0.0, 4.0, 0.0014, 1.2744, 0.4052, 0.0098, 2868.5, 23.47, 0.94, 0.0, 0.15], 
     [2357.0, 130.0, 46.0, 81.0, 4.0, 2.0, 12.0, 0.046, 1.5735, 0.0156, 0.0006, 3013.0, 24.4, 0.48, 0.0, 0.02], 
     [4584.4, 55.0, 38.8, 46.2, 4.4, 0.4, 7.8, 0.03622, 1.73982, 0.79498, 0.0007, 3077.454, 23.836, 0.632, 0.0, 0.17200000000000001]
]

model = joblib.load("./RFR")

def get_ave_mat(funcs):
    res = [0] * 16
    for index in funcs:
        for i in range(16):
            res[i] += LCs[index][i]
    res = [i/len(funcs) for i in res]
    return res


if __name__ == '__main__':
    event = None
    if len(sys.argv) < 2:
        print(0 > 1)
        exit(0)
    else:
        event = sys.argv[1].split(",")

    server0 = []
    server1 = []
    
    BE_dict = {}
    for i in event:
        v = i.split(":")
        if int(v[0]) < 22:
            if int(v[1]) == 0:
                server0.append(int(v[0]))
            else:
                server1.append(int(v[0]))
        else:
            BE_dict[int(v[0])] = int(v[1])

    mat0 = [0.0] * 16
    mat1 = [0.0] * 16
    if len(server0) > 0:
        mat0 = get_ave_mat(server0)
    if len(server1) > 0:
        mat1 = get_ave_mat(server1)

    features = []
    features.extend(mat0)
    for i in [22, 23, 24]:
        if i in BE_dict and BE_dict[i] == 0:
            features.extend(BEs[i%22])
        else:
            features.extend([0.0] * 16)
    features.extend(mat1)
    for i in [22, 23, 24]:
        if i in BE_dict and BE_dict[i] == 1:
            features.extend(BEs[i%22])
        else:
            features.extend([0.0] * 16)
    
    print(model.predict([features])[0] > 0.65)
    